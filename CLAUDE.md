# CellAnalyzer - Резюме проекта

## Описание проекта
CellAnalyzer - десктопное приложение для автоматического распознавания и анализа клеток организма на микроскопических изображениях. Приложение решает задачу автоматизации рутинной работы исследователей по измерению диаметров клеток, которая ранее выполнялась вручную.

## Основные функции
- Автоматическое распознавание клеток круглой формы на микроскопических изображениях
- Интерактивная настройка параметров распознавания с предпросмотром в реальном времени
- Фильтрация артефактов (капли воды и другие помехи)
- Автоматическое определение масштабной линейки на изображении
- Расчет диаметра клеток в пикселях и нанометрах
- Ручная верификация распознанных клеток
- Экспорт результатов в CSV формат
- Сохранение отдельных изображений каждой клетки
- Сохранение и загрузка наборов параметров для разных типов изображений

## Технологический стек
- **GUI Framework**: Qt6 (C++)
- **Обработка изображений**: OpenCV 4.11.0
- **Компилятор**: MSVC 2022
- **Система сборки**: CMake
- **Целевая платформа**: Windows x64

## Основные алгоритмы

### 1. Детекция клеток
- **Предобработка**: Медианное размытие (cv::medianBlur)
- **Основной метод**: HoughCircles с настраиваемыми параметрами
- **Параметры по умолчанию**:
  - dp = 1.0 (разрешение аккумулятора)
  - minDist = 30.0 (минимальное расстояние между центрами)
  - param1 = 90.0 (порог для детектора границ Canny)
  - param2 = 50.0 (порог для центра круга)
  - minRadius = 30 (минимальный радиус в пикселях)
  - maxRadius = 150 (максимальный радиус в пикселях)
- **Фильтрация**: По видимости круга (минимум 60% должно быть видно)

### 2. Определение масштаба
- Поиск масштабной линейки методом Хафа (HoughLinesP)
- Распознавание числового значения рядом с линейкой (заглушка для OCR)
- Расчет коэффициента масштабирования (нм/пиксель)

### 3. Измерение клеток
- Вычисление диаметра в пикселях через радиус найденного круга
- Конвертация в нанометры с использованием масштабного коэффициента

## Архитектура приложения

### Главные компоненты

#### MainWindow
- Управление основным workflow приложения
- Два состояния интерфейса: начальное (без изображений) и рабочее (с изображениями)
- Нижний тулбар с элементами управления
- Поддержка responsive дизайна с QScrollArea

#### ParameterTuningWidget
- Интерактивная настройка параметров HoughCircles
- Предпросмотр результатов в реальном времени
- Сохранение и загрузка наборов параметров (пресетов)
- Горизонтальная компоновка: изображение слева, параметры справа

#### PreviewGrid
- Динамическая сетка превью изображений
- Изменяемый размер превью (100-500 пикселей)
- Кнопка удаления на каждом превью
- Автоматическая перекомпоновка при изменении размера окна

#### ImageProcessor
- Основная логика обработки изображений
- Применение алгоритма HoughCircles с заданными параметрами
- Определение масштаба изображения

#### VerificationWidget
- Сетка найденных клеток для ручной верификации
- Отображение диаметра в пикселях и нанометрах
- Возможность удаления ложных срабатываний
- Экспорт результатов в CSV

#### SettingsManager (Singleton)
- Централизованное управление настройками приложения
- Сохранение параметров в JSON файл
- Автоматическое сохранение при изменении
- Путь к файлу настроек: AppData/Local/CellAnalyzer/settings.json

### Вспомогательные компоненты
- **CellItem**: Структура для хранения данных о клетке
- **CellItemWidget**: Виджет для отображения отдельной клетки
- **Utils**: Вспомогательные функции (расчет видимости круга)

## Пользовательский интерфейс

### Начальное состояние
- Центрированная кнопка "Выбрать изображения" (250px ширина)
- Минималистичный дизайн без лишних элементов

### Рабочее состояние
- Сетка превью изображений
- Нижний тулбар с элементами:
  - Ползунок размера превью (100-500px)
  - Кнопка "Очистить" (красная)
  - Кнопка "Добавить изображения" (зеленая)
  - Кнопка "Начать анализ" (голубая)

### Стилизация
- Все кнопки со скругленными углами (border-radius: 10px)
- Цветовая схема:
  - Основная кнопка выбора: #2196F3
  - Кнопка очистки: #f44336
  - Кнопка добавления: #4CAF50
  - Кнопка анализа: #03A9F4
- Адаптивные hover эффекты

## Пользовательские сценарии

### 1. Первичная загрузка
1. Запуск приложения показывает центрированную кнопку
2. Выбор изображений переключает интерфейс в рабочий режим
3. Появляется нижний тулбар с элементами управления

### 2. Настройка параметров (для одного изображения)
1. При выборе одного изображения открывается экран настройки
2. Пользователь видит изображение и может менять 6 параметров
3. Результаты обновляются в реальном времени
4. Возможность сохранить набор параметров с именем
5. Кнопка "Применить параметры и продолжить"

### 3. Анализ
1. Для нескольких изображений используются сохраненные параметры
2. Обработка всех изображений с прогресс-баром
3. Автоматическое определение масштаба
4. Детекция клеток на всех изображениях

### 4. Верификация и экспорт
1. Отображение всех найденных клеток в сетке
2. Возможность удалить ложные срабатывания
3. Экспорт в CSV с полной информацией
4. Сохранение отдельных изображений клеток

## Сохраняемые настройки
- Параметры HoughCircles (6 параметров)
- Размер превью изображений
- Пользовательские наборы параметров (пресеты)

## Обработка ошибок
- Проверка загрузки изображений
- Обработка исключений OpenCV
- Валидация границ при рисовании
- Предупреждения при отсутствии найденных клеток

## Результаты работы
1. CSV файл с колонками:
   - Имя исходного файла
   - Номер клетки
   - Координаты центра (X, Y)
   - Диаметр в пикселях
   - Диаметр в нанометрах
2. Набор изображений отдельных клеток
3. Сохраненные настройки для последующих сессий

## Преимущества решения
- Интуитивный пользовательский интерфейс
- Гибкая настройка параметров распознавания
- Визуальный контроль на каждом этапе
- Сохранение настроек между сессиями
- Responsive дизайн для разных размеров экрана
- Быстрая обработка без специальных требований к GPU